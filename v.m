function val= v(g,wx,tau)
    [kpg0,kdg0]=K0(g,tau);
    u=[kpg0;kdg0];
    [kpw,kdw]=sregion(-g,wx,tau);
    v=[kpw;kdw];
    b0=6;b1=2/5;a0=6;a1=1;a2=3/50;    
    dkpC= @(w,s,t) (1./(((b0-b1.*s).^2.*w+b1.^2.*w.^3).^2)).*exp(-s.*t).*(-w.*(s.^3.*(b0-b1.*s).^3.*(a0+s.*(-a1+a2.*s)).*t+(-2.*a0.*b0.^3+4.*b0.^2.*(a1.*b0+a0.*b1).*s-4.*b0.^2.*(a2.*b0+3.*a1.*b1).*s.^2+8.*b0.*b1.*(2.*a2.*b0+a1.*b1).*s.^3-2.*b1.^2.*(7.*a2.*b0+a1.*b1).*s.^4+4.*a2.*b1.^3.*s.^5+s.*(b0-b1.*s).*(a0.*(b0.^2-3.*b0.*b1.*s+3.*b1.^2.*s.^2)+s.^2.*(a1.*b1.*(2.*b0-3.*b1.*s)+a2.*(-2.*b0.^2+b0.*b1.*s+2.*b1.^2.*s.^2))).*t).*w.^2-(-4.*(b0-b1.*s).^2.*(-a1.*b1+a2.*(b0+2.*b1.*s))+(b0.^2.*(-a1.*b0+a0.*b1)+b0.*(3.*a2.*b0.^2+b1.*(a1.*b0-3.*a0.*b1)).*s+b1.*(-7.*a2.*b0.^2+b1.*(a1.*b0+3.*a0.*b1)).*s.^2+b1.^2.*(7.*a2.*b0-3.*a1.*b1).*s.^3).*t).*w.^4+b1.*(2.*a2.*b1.*(b0+2.*b1.*s)+a2.*(b0.^2-5.*b0.*b1.*s+2.*b1.^2.*s.^2).*t+b1.*(-a0.*b1.*t+a1.*(-2.*b1+b0.*t+b1.*s.*t))).*w.^6+a2.*b1.^3.*t.*w.^8).*cos(t.*w)+(s.^3.*(b0-b1.*s).^3.*(a0+s.*(-a1+a2.*s))+s.*(-b0+b1.*s).*(s.^2.*(-2.*a2.*b0.^2+2.*a1.*b0.*b1+a2.*b0.*b1.*s+a1.*b1.^2.*s-2.*a2.*b1.^2.*s.^2+(b0-b1.*s).*(a2.*s.*(3.*b0-2.*b1.*s)+a1.*(-2.*b0+b1.*s)).*t)+a0.*(-b1.^2.*s.^2+b0.^2.*(1+s.*t)-b0.*b1.*s.*(3+s.*t))).*w.^2+(a0.*b1.*(3.*b0.^2-5.*b0.*b1.*s+b1.^2.*s.^2)-a0.*b0.*(b0.^2-2.*b0.*b1.*s+2.*b1.^2.*s.^2).*t+a2.*s.*(b0.^3.*(9-2.*s.*t)-13.*b0.*b1.^2.*s.^2.*(-1+s.*t)+2.*b1.^3.*s.^3.*(-2+3.*s.*t)+b0.^2.*b1.*s.*(-21+8.*s.*t))+a1.*(3.*b0.^2.*b1.*s.*(1-2.*s.*t)+b0.^3.*(-3+2.*s.*t)-b1.^3.*s.^3.*(1+3.*s.*t)+b0.*b1.^2.*s.^2.*(3+8.*s.*t))).*w.^4+(-b1.*(a1.*b1.*(b0+b1.*s)+a1.*(b0-3.*b1.*s).*(b0-b1.*s).*t+a0.*b1.*(-b1+b0.*t))+a2.*(-5.*b0.^2.*b1+b0.^3.*t+b0.*b1.^2.*s.*(13-5.*s.*t)+6.*b1.^3.*s.^2.*(-1+s.*t))).*w.^6+b1.^2.*(-a1.*b1.*t+a2.*(b0.*t+b1.*(-3+2.*s.*t))).*w.^8).*sin(t.*w));
    dkdC= @(w,s,t) (1./(((b0-b1.*s).^2.*w+b1.^2.*w.^3).^2)).*exp(-s.*t).*(w.*(s.^2.*(-b0+b1.*s).^3.*(a0+s.*(-a1+a2.*s)).*t-(2.*(-a1.*b0.^3+a0.*b0.^2.*b1+a2.*s.*(2.*b0-b1.*s).*(2.*b0.^2-2.*b0.*b1.*s+b1.^2.*s.^2))-(b0-b1.*s).*(a0.*b0.^2-3.*a1.*b0.^2.*s+(6.*a2.*b0.^2+b1.*(3.*a1.*b0-2.*a0.*b1)).*s.^2+b1.*(-8.*a2.*b0+a1.*b1).*s.^3+a2.*b1.^2.*s.^4).*t).*w.^2+(4.*a2.*b1.*(b0-b1.*s).^2-a2.*(b0.^3+b0.^2.*b1.*s-11.*b0.*b1.^2.*s.^2+5.*b1.^3.*s.^3).*t+b1.*(a0.*b1.*(b0+b1.*s)+a1.*(b0.^2-5.*b0.*b1.*s+b1.^2.*s.^2)).*t).*w.^4+b1.^2.*(2.*a2.*b1+a1.*b1.*t-a2.*(b0+3.*b1.*s).*t).*w.^6).*cos(t.*w)+(s.^2.*(b0-b1.*s).^3.*(a0+s.*(-a1+a2.*s))-(b0-b1.*s).*(-a0.*b0.^2+3.*a1.*b0.^2.*s-6.*a2.*b0.^2.*s.^2-3.*a1.*b0.*b1.*s.^2-2.*a0.*b1.^2.*s.^2+8.*a2.*b0.*b1.*s.^3+3.*a1.*b1.^2.*s.^3-5.*a2.*b1.^2.*s.^4+s.*(-b0+b1.*s).*(a0.*(-2.*b0+b1.*s)+s.*(a1.*(3.*b0-2.*b1.*s)+a2.*s.*(-4.*b0+3.*b1.*s))).*t).*w.^2+(3.*a1.*b1.*(b0.^2-b0.*b1.*s+b1.^2.*s.^2)-a1.*(b0.^3-6.*b0.*b1.^2.*s.^2+4.*b1.^3.*s.^3).*t+a2.*(b0.*b1.^2.*s.^2.*(9-4.*s.*t)-3.*b0.^2.*b1.*s.*(1+2.*s.*t)+b0.^3.*(-3+4.*s.*t)+b1.^3.*s.^3.*(-7+5.*s.*t))+a0.*b1.*(b0.^2.*t+b1.^2.*s.*(-1+2.*s.*t)-b0.*(b1+4.*b1.*s.*t))).*w.^4+b1.*(-a2.*(b0.^2.*t+b1.^2.*s.*(3-s.*t)+b0.*(b1-6.*b1.*s.*t))+b1.*(a0.*b1.*t+a1.*(b1-(b0+2.*b1.*s).*t))).*w.^6-a2.*b1.^3.*t.*w.^8).*sin(t.*w));    
    f= @(x) dkpC(x,g,tau).^2+dkdC(x,g,tau).^2;
    val=integral(f,0,wx(end))+norm(v(:,end)-u,2);
end
